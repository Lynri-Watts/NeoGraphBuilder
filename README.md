# Knowledge Graph Generator - 基于Neo4j的智能知识图谱构建系统

## 项目简介

Knowledge Graph Generator是一个专业的知识图谱生成工具，**基于高性能Neo4j图数据库**，能够从PDF文献中自动提取结构化知识，构建概念和实体之间的关系网络。该工具通过大模型提取、多维度相似度匹配和智能合并机制，确保生成的知识图谱具有高质量和准确性。

**核心特性**：
- 🧠 **智能知识提取**：基于大语言模型的精准概念和实体识别
- 🔗 **多维度关系构建**：支持精确匹配、别名匹配、向量相似度匹配
- 📊 **图数据库优势**：利用Neo4j实现毫秒级复杂关系查询
- 🔍 **智能问答系统**：基于知识图谱的RAG问答功能
- 📁 **批量处理**：支持大规模文档的批量导入和处理

目前该项目已具备完整的核心功能，可用于生产环境的知识图谱构建任务。我们欢迎社区贡献，包括但不限于：

- 报告错误或问题
- 建议新功能或改进  
- 提交代码变更（请先创建issue讨论）

## 核心功能

### 📚 文档处理与知识提取
- **多格式支持**：支持PDF文档的文本提取，可扩展支持CAJ等格式
- **智能文本分块**：支持带重叠的文本分块，确保上下文连续性
- **大模型驱动提取**：通过大语言模型准确识别概念和实体

### 🔗 知识图谱构建
- **多维度相似度匹配**：支持精确匹配、别名匹配、模糊匹配，确保实体对齐的准确性
- **向量相似度实体对齐**：基于Neo4j向量查询优化的向量相似度方法，结合现代NLP技术精准把控语义
- **智能知识合并**：自动合并相似节点和关系，避免知识图谱冗余

### 📊 高效图数据库存储
- **Neo4j图数据库**：利用图数据结构优势，实现**毫秒级复杂关系查询**
- **高效查询性能**：对于复杂的多跳关系查询，Neo4j提供线性性能优势
- **可视化支持**：内置强大的可视化工具，便于直观理解知识图谱结构

### 🔍 智能问答系统
- **基于知识图谱的RAG问答**：从知识图谱中检索相关信息，生成准确回答
- **多跳关系查询**：支持复杂的知识关联和路径查找
- **相似节点搜索**：基于跳数和向量相似度的智能节点发现

### 📁 批量处理工具
- **多进程并行处理**：支持大规模文档的批量导入
- **失败报告生成**：自动生成处理失败的文件报告
- **进度监控**：实时显示处理进度和统计信息

### ⚙️ 灵活配置选项
- **自定义参数**：支持自定义分块大小、重叠大小等参数
- **多种大模型支持**：兼容OpenAI API格式的各种大模型服务
- **配置文件管理**：通过配置文件灵活管理数据库和模型连接

## 安装说明

### 1. 环境要求

- Python 3.8+
- Neo4j 5.0+
- 大模型服务（支持OpenAI API格式）

### 2. 安装依赖

```bash
# 克隆仓库
git clone <repository-url>
cd <repository-folder>

# 创建虚拟环境（推荐）
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt

# 下载spaCy英文模型
python -m spacy download en_core_web_sm
```

### 3. 配置数据库和模型

复制配置文件模板并根据实际环境修改：

```bash
# 复制配置文件模板
cp config.ini.example config.ini

# 编辑配置文件，修改数据库连接信息和大模型配置
# [NEO4J_CONFIG]
# uri = neo4j://127.0.0.1:7687
# user = neo4j  
# password = your_password_here

# [LLM_CONFIG]
# base_url = http://localhost:8001/v1
# api_key = your_api_key_here
# model = deepseek-r1
```

## 使用方法

### 📄 单文档处理

```bash
# 基本使用 - 处理单个PDF文件
python main.py <pdf_file_path>

# 自定义参数
python main.py <pdf_file_path> --chunk-size 5000 --overlap-size 500
```

### 📁 批量文档处理

```bash
# 批量处理目录下所有PDF文件
python batch_import.py <directory_path>

# 限制并行进程数
python batch_import.py <directory_path> --max-workers 2

# 限制处理文件数量
python batch_import.py <directory_path> --limit 10
```

### 🔍 智能问答

```bash
# 启动交互式问答系统
python query.py

# 程序会提示输入问题，然后基于知识图谱生成回答
```

### ⚙️ 参数说明

**main.py 参数**：
- `pdf_file_path`: PDF文件路径（必需）
- `--chunk-size`: 文本分块大小（默认：5000字符）
- `--overlap-size`: 块之间的重叠大小（默认：500字符）
- `--disable-report`: 禁用报告生成（可选）

**batch_import.py 参数**：
- `directory_path`: 包含PDF文件的目录路径（必需）
- `--max-workers`: 最大并行进程数（默认：3）
- `--limit`: 限制处理的文件数量（可选）

## 项目结构

```
├── main.py                 # 主程序入口 - 单文档处理
├── batch_import.py         # 批量导入工具 - 多文档并行处理
├── query.py               # 智能问答系统 - 基于知识图谱的RAG问答
├── database.py            # Neo4j数据库操作 - 图数据库连接和查询
├── extractor.py           # 知识提取器 - 大模型驱动的实体关系提取
├── llm.py                 # 大模型客户端 - LLM API调用封装
├── config.ini.example     # 配置文件模板 - 数据库和模型配置示例
├── requirements.txt       # 项目依赖 - Python包列表
├── .gitignore            # Git忽略文件
└── README.md             # 项目文档
```

## 输出结果

### 📊 处理报告
程序执行完成后，将在`reports`目录下生成以下文件：

1. **JSON报告文件**：包含处理统计信息、节点和关系的详细数据
2. **失败文件报告**：批量处理时记录处理失败的文件和错误信息
3. **可视化图表**：包括知识图谱结构分析、相似度匹配分布等图表

### 🗄️ 知识图谱数据
存储在Neo4j数据库中，包含：
- **Concept节点**：抽象概念、理论、学科等
- **Entity节点**：具体实体、人物、组织等  
- **关系边**：节点间的各种关系类型和权重

## 知识图谱结构

### 🏗️ 节点类型
知识图谱中的节点分为两种类型：

- **Concept（概念）**：抽象的概念、理论、思想、学科等非实体事物，或者实体所属的类别
- **Entity（实体）**：现实中唯一存在的具体事物，必须满足无歧义、能够脱离语境单独存在等条件

### 🔗 关系类型
关系包含源节点、目标节点、关系类型和权重等属性，支持：
- **IS_ALIAS**：别名关系，表示两个节点指向同一实体
- **语义关系**：基于内容理解的各种语义关联
- **自定义关系**：可根据具体领域定义专门的关系类型

### 🚀 Neo4j技术优势

- **高效查询性能**：对于复杂的多跳关系查询，Neo4j能够提供线性性能，而传统关系型数据库通常是指数级增长
- **直观的数据建模**：图数据模型自然映射知识网络结构，无需复杂的表连接操作
- **向量查询支持**：原生支持向量相似度查询，实现高效的语义搜索
- **可视化支持**：内置强大的可视化工具，便于直观理解知识图谱结构和关系模式
- **可扩展性**：支持大规模知识图谱存储和查询，适应不断增长的数据需求

## 🔧 高级功能

### 🎯 相似节点搜索
项目提供了强大的相似节点搜索功能：

```python
# 基于跳数和向量相似度的智能搜索
similar_nodes = kg.search_similar_nodes(
    start_node_id="node_id",
    start_node_type="Concept", 
    max_hops=2,
    dot_threshold=0.7
)
```

### 📈 批量处理监控
- 实时进度显示
- 失败文件自动重试
- 详细的处理统计报告
- 多进程并行处理优化

### 🔄 智能合并机制
- 基于向量相似度的节点合并
- 别名关系的自动识别
- 关系权重的智能计算
- 重复内容的自动去重

## 注意事项

### 📋 环境要求
1. **Neo4j数据库**：确保Neo4j 5.0+服务已启动并可正常连接
2. **Python环境**：Python 3.8+，推荐使用虚拟环境
3. **spaCy模型**：需要单独下载英文模型 `python -m spacy download en_core_web_sm`
4. **大模型服务**：确保配置的大模型API服务可正常访问

### ⚠️ 使用建议
1. **文件大小**：对于大文件，建议调整分块大小以获得更好的性能
2. **内存管理**：批量处理大量文件时，注意监控内存使用情况
3. **网络连接**：确保大模型API服务的网络连接稳定
4. **数据备份**：定期备份Neo4j数据库数据

### 🐛 常见问题
1. **PDF提取失败**：某些PDF可能受密码保护或格式特殊，建议预处理
2. **模型调用超时**：可调整LLM配置中的超时参数
3. **内存不足**：减少并行进程数或分块大小
4. **连接失败**：检查配置文件中的数据库和模型连接参数

### 🔧 性能优化
- **并行处理**：根据CPU核心数调整批量处理的并行进程数
- **分块策略**：根据文档类型调整分块大小和重叠大小
- **缓存机制**：利用向量索引加速相似度查询
- **数据库优化**：定期维护Neo4j数据库索引和统计信息

## 📞 技术支持

如遇到问题或需要技术支持，请：
1. 查看项目日志文件（`app.log`、`batch_import.log`）
2. 检查配置文件设置是否正确
3. 在GitHub Issues中提交问题，提供详细的错误信息和环境描述

## 📄 许可证

本项目采用开源许可证，具体请查看LICENSE文件。

---

**🚀 开始构建您的知识图谱吧！**